<!--
  KnowsNav â€” Integrated EyeWrite + SnazyCam Interface

  RULES FOR THIS BUILD:
  - SnazyCam runs EXACTLY as-is and stays running continuously.
  - EyeWrite runs EXACTLY as-is and remains the primary UI layer.
  - driver.js only:
      (1) manages layering (SnazyCam behind, but can pop on top)
      (2) reads SnazyCam cursor data and drives EyeWrite mousemove
  - We do NOT create a new SnazyCam controls button in KnowsNav.
    We use SnazyCamâ€™s own button from snazycam/controls.js.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KnowsNav â€“ EyeWrite + SnazyCam</title>

  <!-- EyeWrite stylesheet (unmodified) -->
  <link rel="stylesheet" href="eyewrite/style.css" />

  <style>
    html, body { margin: 0; height: 100%; background: #000; overflow: hidden; }

    /* SnazyCam is always running. driver.js controls opacity/z-index/pointer-events. */
    #snazycam-container {
      position: fixed;
      inset: 0;
      display: block;          /* keep camera alive */
      z-index: 0;              /* behind by default */
      opacity: 0;              /* hidden by default */
      pointer-events: none;    /* behind by default */
    }
    #snazycam-container video,
    #snazycam-container canvas {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Make sure EyeWrite cursor ring stays visible and above SnazyCam by default */
    #cursorRing {
      position: fixed;
      z-index: 2500;
      pointer-events: none;
      display: block;
    }
  </style>
</head>
<body>

  <!-- ============= EyeWrite UI (copied verbatim) ============= -->
  <div id="toolbar">
    <select id="fontSelect">
      <option value="Arial">Arial</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Courier New">Courier New</option>
      <option value="Verdana">Verdana</option>
      <option value="Georgia">Georgia</option>
    </select>
    <select id="fontSize">
      <option value="12">12</option>
      <option value="14">14</option>
      <option value="16" selected>16</option>
      <option value="20">20</option>
      <option value="24">24</option>
    </select>
    <button id="boldBtn"><b>B</b></button>
    <button id="italicBtn"><i>I</i></button>
    <button id="underlineBtn"><u>U</u></button>
    <button id="cursorDefault">Cursor â–£</button>
    <button id="cursorCross">Cross âœ›</button>
    <button id="cursorText">Text âœ</button>
    <button id="kbToggle">âš¡ QuickType</button>
    <button id="hoverToggle" class="active">ğŸŒ€ Hover ON</button>
    <button id="voiceBtn">Voice Modulation</button>
    <div id="voiceControls" class="hidden">
      <label>Voice:</label>
      <select id="voiceSelect"></select>
      <label>Pitch:</label>
      <input type="range" id="pitchSlider" min="0.5" max="2" value="1" step="0.1" />
      <label>Rate:</label>
      <input type="range" id="rateSlider" min="0.5" max="2" value="1" step="0.1" />
      <button id="previewVoice">Preview</button>
    </div>
    <button id="searchBtn">ğŸ” Search</button>
    <button id="speakBtn">ğŸ”Š Speak</button>
    <div class="saveWrapper">
      <button id="saveBtn">ğŸ’¾ Save</button>
      <div id="saveMenu" class="hidden">
        <button data-format="txt">TXT</button>
        <button data-format="docx">DOCX</button>
        <button data-format="pdf">PDF</button>
      </div>
    </div>
    <button id="instructionsBtn">â” Instructions</button>
  </div>

  <div id="instructionsModal" class="hidden">
    <div class="modalContent" id="instructionsContent">
      <h2>ğŸ‘ï¸ EyeWrite â€” Quick Start Guide</h2>
      <p>
        Welcome to <b>EyeWrite</b> â€” a hands-free writing and communication tool.<br><br>
        <b>Navigation:</b><br>
        â€¢ Hover for 1.5 s to click (Precision Mode)<br>
        â€¢ Hover for 0.7 s or single blink to click (QuickType Mode)<br><br>
        <b>Controls:</b><br>
        â€¢ âš¡ <b>QuickType</b> â€” faster hover speed<br>
        â€¢ ğŸŒ€ <b>Hover ON/OFF</b> â€” toggle dwell clicking<br>
        â€¢ ğŸ”Š <b>Speak</b> â€” text-to-speech output<br>
        â€¢ ğŸ’¾ <b>Save</b> â€” export text (TXT, DOCX, PDF)<br>
        â€¢ ğŸ” <b>Search</b> â€” open half-screen web results<br><br>
        <b>Keyboard:</b><br>
        â€¢ Type by gaze or blink selection<br>
        â€¢ â€œCapsâ€ toggles uppercase, â€œShiftâ€ applies one-time uppercase<br><br>
        <b>Voice Modulation:</b><br>
        â€¢ Adjust pitch, rate, and tone live<br><br>
        <b>Exit:</b><br>
        â€¢ Hover away for 0.7 s or press ESC to close<br><br>
        EyeWrite is built for accessibility, freedom, and creative expression.<br>
        <i>â€œWhere the hands may rest, the eyes and voice continue to speak.â€</i>
      </p>
      <button id="closeInstructions">Close</button>
    </div>
  </div>

  <div id="textContainer">
    <button id="scrollUp" class="scrollBtn">â–² Scroll Up</button>
    <div id="textArea" contenteditable="true"></div>
    <button id="scrollDown" class="scrollBtn">â–¼ Scroll Down</button>
  </div>

  <div id="keyboard">
    <div id="kbHeader">
      <span id="kbMode">ğŸ•Š Precision</span>
    </div>
    <div class="kbRow" id="row1"><button>`</button><button>1</button><button>2</button><button>3</button><button>4</button><button>5</button><button>6</button><button>7</button><button>8</button><button>9</button><button>0</button><button>-</button><button>=</button><button class="wide">âŒ«</button></div>
    <div class="kbRow" id="row2"><button class="wide">Tab</button><button>Q</button><button>W</button><button>E</button><button>R</button><button>T</button><button>Y</button><button>U</button><button>I</button><button>O</button><button>P</button><button>[</button><button>]</button><button>\</button></div>
    <div class="kbRow" id="row3"><button class="wide">Caps</button><button>A</button><button>S</button><button>D</button><button>F</button><button>G</button><button>H</button><button>J</button><button>K</button><button>L</button><button>;</button><button>'</button><button class="wide">â†µ</button></div>
    <div class="kbRow" id="row4"><button class="wide">Shift</button><button>Z</button><button>X</button><button>C</button><button>V</button><button>B</button><button>N</button><button>M</button><button>,</button><button>.</button><button>/</button><button>â†‘</button></div>
    <div class="kbRow" id="row5"><button class="wide">Ctrl</button><button class="extraWide">â£</button><button class="wide">Alt</button><button>â†</button><button>â†“</button><button>â†’</button></div>
  </div>

  <!-- EyeWrite cursor -->
  <div id="cursorRing"></div>

  <!-- ============= SnazyCam Container (always alive) ============= -->
  <div id="snazycam-container">
    <video id="video" autoplay muted playsinline></video>
    <canvas id="overlay"></canvas>
  </div>

  <!-- ============= Script Imports ============= -->

  <!-- TensorFlow + BlazeFace for SnazyCam -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface"></script>

  <!-- SnazyCam (unmodified) -->
  <script src="snazycam/nose.js"></script>
  <script src="snazycam/controls.js"></script>
  <script src="snazycam/hoverClick.js"></script>

  <!-- EyeWrite (unmodified) -->
  <script src="eyewrite/app.js"></script>

  <!-- KnowsNav driver -->
  <script src="driver.js"></script>
</body>
</html>
